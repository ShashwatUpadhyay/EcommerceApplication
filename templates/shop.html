{% extends "index.html" %}
{% block title %}Ecommerce Home page{% endblock title %}

{% block content %}

<div class="bg-gray-100 min-h-screen">

    <div class="container mx-auto p-4 flex flex-col md:flex-row gap-4">
        
        <!-- Sidebar -->
        <aside class="md:w-1/4 bg-white p-4 rounded-lg shadow-md transition-all duration-300 transform md:translate-x-0"
            id="sidebar">
            <h2 class="text-lg font-semibold mb-4 flex justify-between items-center">
                Category    
                <button class="md:hidden text-gray-600" onclick="toggleSidebar()">✖</button>
            </h2>

            <!-- Category Dropdown -->
            <form id="filterForm" method="GET" action="{% url 'shop' %}">
                <details class="mb-4">
                    <summary class="cursor-pointer font-medium text-gray-700 flex float-center">
                        <input type="radio" id="category" name="category" value="all" onchange="document.getElementById('filterForm').submit();"
                        {% if request.GET.category == 'all'|stringformat:"s" %}checked{% endif %}> 
                        <span class="float-left ml-3">All Products</span>

                    </summary>
                </details>

                {% for category in categories %}
                <details class="mb-4 group">
                    <summary class="cursor-pointer font-medium text-gray-700 flex  float-center">
                        <input type="radio" id="category" name="category" value="{{ category.name }}" onchange="document.getElementById('filterForm').submit();"
                        {% if request.GET.category == category.name|stringformat:"s" %}checked{% endif %} placeholder="{{ category.name }}"> 
                        <span class="float-left ml-3">{{ category.name }}</span>
                        <span class="transition-transform duration-200 group-open:rotate-180">▼</span>
                    </summary>
                    <div class="mt-2 space-y-2 pl-4">
                        {% for sub in category.sub_category.all %}
                        <label class="flex items-center cursor-pointer">
                            <input id="category" type="radio" name="category" value="{{ sub.name }}" class="mr-2 text-blue-500 focus:ring-2"
                                onchange="document.getElementById('filterForm').submit();"
                                {% if request.GET.category == sub.name|stringformat:"s" %}checked{% endif %}>
                            <span class="text-gray-700 hover:text-blue-500 transition">{{ sub.name }}</span>
                        </label>
                        {% endfor %}
                    </div>
                </details>
                {% endfor %}
            </form>
        </aside>

        <!-- Mobile Sidebar Toggle Button -->
        <button class="md:hidden bg-blue-500 text-white px-4 py-2 rounded-lg shadow-md"
            onclick="toggleSidebar()">☰ Filters</button>

        <!-- Products Section -->
        <section class="md:w-3/4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            <!-- Product Card -->
            {% for product in products %}
            <a href="{% url 'product' product.slug %}" class="block bg-white p-4 rounded-lg shadow-md hover:shadow-lg transition">
                <img src="{{ product.latest_image.img.url }}" alt="{{ product.title }}"
                    class="w-full h-48 object-cover rounded-lg">
                <h3 class="text-lg font-medium mt-2 text-gray-800">{{ product.title }}</h3>
                <p class=" font-small mt-2 text-gray-800">{{ product.category.name }}</p>
                <p class="text-gray-600">₹{{ product.price }}</p>
                <button class="mt-2 w-full bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition">
                    Add to Cart
                </button>
            </a>
            {% endfor %}
        </section>

    </div>

</div>

<!-- JavaScript for Sidebar Toggle -->
<script>
    function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        sidebar.classList.toggle("-translate-x-full");
    }
</script>

{% endblock content %}
